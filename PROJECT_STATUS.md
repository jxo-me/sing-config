# sing-config 项目状态与下一步规划

> 最后更新：2025年

## 📊 项目当前状态总结

### ✅ 已完成的核心功能

#### 1. 编辑器基础
- ✅ CodeMirror 6 JSON 编辑器
- ✅ Tab 键缩进支持（2 空格）
- ✅ 语法高亮
- ✅ 实时 Schema 验证（防抖 300ms，基于 `json-schema-library`）
- ✅ 错误提示和跳转定位（精确到行和列）
- ✅ 滚动位置记忆
- ✅ 多语言错误消息（完整中英文支持）
- ✅ 自动折行（避免横向滚动条）
- ✅ 自定义滚动条样式
- ✅ JSON Schema 自动补全

#### 2. 所有配置表单
- ✅ Log（日志配置）
- ✅ DNS（DNS 服务器、规则、全局设置）
- ✅ NTP（网络时间协议）
- ✅ Certificate（证书配置）
- ✅ Endpoints（端点配置）
- ✅ Inbounds（入站配置）
- ✅ Outbounds（出站配置）
- ✅ Route（路由配置，包括嵌套逻辑规则）
- ✅ Services（服务配置）
- ✅ Experimental（实验性功能）

#### 3. 高级功能
- ✅ **嵌套逻辑规则编辑器**（AND/OR 树，支持多层嵌套）
- ✅ **配置克隆**（快速复制现有配置）
- ✅ **模板库**（常用协议模板、DNS 方案、路由方案）
- ✅ **设置向导**（首配向导，引导新用户）
- ✅ **预检检查（Preflight）**（端口冲突、标签引用检查等）

#### 4. 用户体验优化
- ✅ 多语言支持（中文/英文，完整覆盖）
- ✅ 差异预览（配置变更对比）
- ✅ 自定义右键菜单（白色主题，多语言，支持格式化/压缩/清空）
- ✅ 错误提示字体大小优化
- ✅ 表单/JSON 模式切换，滚动位置记忆
- ✅ 窗口大小调整（1400x900，主流编辑器尺寸）
- ✅ 取消自动格式化（避免打断用户编辑）
- ✅ 编辑器交互优化（自动折行、优化字体、行高、内边距）
- ✅ 错误消息完整多语言对齐（包括运行检查）

#### 5. 文件操作
- ✅ 打开配置文件
- ✅ 保存/另存为
- ✅ 格式化 JSON（右键菜单）
- ✅ 压缩 JSON（右键菜单，单行输出）
- ✅ 清空内容（右键菜单）
- ✅ 加载示例配置
- ✅ 保存前验证（失败时阻止保存）

## 🎯 下一步建议

### 🔥 优先级 1：测试与完善（建议立即开始）

#### 1. 全面功能测试
- [x] 测试多语言切换的完整性（已完成）
- [ ] 测试所有表单的保存/加载功能
- [ ] 测试复杂嵌套配置场景
- [ ] 测试边界情况和错误处理
- [ ] 测试文件操作的异常情况
- [ ] 测试格式化/压缩/清空功能的边界情况
- [ ] 测试状态同步在各种场景下的正确性

#### 2. 性能优化
- [ ] 大配置文件加载优化（> 10MB）
- [ ] 实时验证防抖优化
- [ ] 表单渲染性能优化（大量配置项时）
- [ ] 编辑器初始化性能优化

#### 3. 用户体验改进
- [x] ~~优化错误提示的交互（点击跳转定位更精确）~~（已优化，使用精确字符位置映射）
- [ ] 添加加载状态提示（文件读取、保存中）
- [ ] 添加操作确认对话框（未保存时关闭应用）
- [ ] 优化表单字段的提示信息（Tooltip/帮助文本）
- [ ] 添加键盘快捷键说明（帮助菜单或快捷键面板）

### ⭐ 优先级 2：增强功能

#### 1. 查找替换功能
- [ ] 在 JSON 编辑器中添加查找替换面板
- [ ] 支持正则表达式搜索
- [ ] 高亮所有匹配项
- [ ] 键盘快捷键支持（Ctrl+F, Ctrl+H）

#### 2. 最近文件
- [ ] 最近打开的文件列表
- [ ] 在菜单中显示最近文件
- [ ] 清理最近文件记录

#### 3. 配置片段导入/导出
- [ ] 支持导入配置片段（如单个 Outbound）
- [ ] 支持导出配置片段
- [ ] 片段验证功能

#### 4. 撤销/重做增强
- [ ] 在表单模式下支持撤销/重做
- [ ] 显示操作历史记录
- [ ] 支持批量操作的撤销

### 🚀 优先级 3：打包发布

#### 1. 打包配置
- [ ] 优化应用图标和元数据
- [ ] 配置自动更新（如需要）
- [ ] 测试跨平台构建（macOS/Windows/Linux）
- [ ] 代码签名配置（macOS/Windows）

#### 2. 文档编写
- [ ] 用户使用文档
- [ ] 快捷键说明文档
- [ ] 更新 CHANGELOG.md
- [ ] README.md 完善

#### 3. 发布准备
- [ ] 版本号管理
- [ ] 发布说明编写
- [ ] 测试完整发布流程

### 💡 优先级 4：高级特性（可选）

#### 1. 暗色主题
- [ ] 完整的暗色主题支持
- [ ] 主题切换功能
- [ ] 跟随系统主题设置

#### 2. 配置文件管理
- [ ] 多配置文件切换
- [ ] 配置文件分组管理
- [ ] 配置备份和恢复

#### 3. 配置验证增强
- [ ] 添加更多预检规则
- [ ] 自定义验证规则
- [ ] 验证规则模板

#### 4. 协作功能（可选）
- [ ] 配置分享功能
- [ ] 配置导入导出（云同步）

## 📋 建议的下一步行动

### 立即开始
1. **全面功能测试**：确保所有功能正常工作，修复发现的问题
2. **性能测试**：测试大文件加载、复杂配置的处理性能
3. **用户体验审查**：检查所有交互流程，优化不流畅的地方

### 短期目标（1-2周）
1. 完成性能优化和用户体验改进
2. 添加查找替换功能
3. 准备首次发布（v0.1.0）

### 中期目标（1个月）
1. 添加最近文件、配置片段管理等增强功能
2. 完善文档和用户指南
3. 收集用户反馈，持续迭代改进

### 长期目标
1. 根据用户反馈添加新功能
2. 持续优化性能和用户体验
3. 考虑跨平台支持和社区生态

## 📝 技术债务与已知问题

### 待优化项
- [ ] 某些复杂配置场景下表单渲染可能较慢
- [ ] 超大配置文件（> 50MB）的处理需要优化
- [x] ~~错误消息的定位准确性可以进一步提升~~（已优化，使用 `json-source-map` 精确映射）

### 已知限制
- 当前仅支持明亮主题（暗色主题待实现）
- 未实现配置文件的云同步功能
- 撤销/重做在表单模式下功能有限

### 最近修复的问题
- ✅ 修复了 JSON 编辑器与表单模式状态不同步的问题
- ✅ 修复了清空、加载示例后编辑器内容不更新的问题
- ✅ 优化了压缩功能，确保压缩后的 JSON 不会被重新格式化
- ✅ 完善了所有错误消息的多语言支持
- ✅ 移除了自动格式化，避免打断用户编辑

## 🔗 相关文档

- [REQUIREMENTS.md](./REQUIREMENTS.md) - 项目需求与设计文档
- [CHANGELOG.md](./CHANGELOG.md) - 更新日志（待创建）

## 📌 备注

- 本项目基于 Tauri 2 + Vue 3 + TypeScript 构建
- 使用 CodeMirror 6 作为 JSON 编辑器
- 使用 `json-schema-library` 进行 JSON Schema 验证（已替换 AJV）
- 使用 `codemirror-json-schema` 集成编辑器验证和自动补全
- 支持中文和英文两种语言（完整覆盖）

## 📅 最近更新（2025年）

### 核心改进
1. **验证系统重构**
   - 从 AJV 迁移到 `json-schema-library`
   - 与 `codemirror-json-schema` 完全集成
   - 错误定位精确到字符位置（使用 `json-source-map`）

2. **编辑器体验优化**
   - 取消自动格式化，避免打断用户编辑
   - 添加自动折行功能
   - 优化字体、行高、内边距等视觉样式
   - 优化滚动条样式

3. **右键菜单增强**
   - 添加格式化功能
   - 添加压缩功能（单行 JSON）
   - 添加清空功能
   - 移除"使用 Google 搜索"和"翻译"功能

4. **多语言完善**
   - 所有错误消息完整多语言对齐
   - 运行检查（Preflight）完整多语言支持
   - 错误消息包含详细信息（属性名、路径等）

5. **状态同步修复**
   - 修复了 JSON 编辑器与表单模式状态不同步问题
   - 修复了清空、加载示例后编辑器不更新的问题
   - 优化了 `text.value` 与 `currentConfig` 的同步机制

---

*本文档会根据项目进展持续更新*

