# 菜单系统测试指南

## ✅ 已完成的功能

### 后端（Rust）
- ✅ 菜单构建模块（`src-tauri/src/menu.rs`）
- ✅ 多语言菜单文本（`src-tauri/src/menu_i18n.rs`）
- ✅ 菜单事件处理（`src-tauri/src/lib.rs`）
- ✅ 菜单语言更新命令（`update_menu_locale`）

### 前端（Vue/TypeScript）
- ✅ 菜单事件处理器（`src/lib/menu-handler.ts`）
- ✅ Editor 组件菜单集成（`src/pages/Editor.vue`）
- ✅ 语言切换事件监听
- ✅ 格式化功能支持

## 📋 测试清单

### 1. 基本菜单功能测试

#### 文件菜单
- [ ] **打开文件** (`Ctrl+O` / `Cmd+O`)
  - 点击菜单项或使用快捷键
  - 验证能否打开 JSON 文件
  - 验证内容是否正确加载

- [ ] **保存文件** (`Ctrl+S` / `Cmd+S`)
  - 修改配置后点击保存
  - 验证文件是否正确保存
  - 验证保存路径是否正确

- [ ] **另存为** (`Ctrl+Shift+S` / `Cmd+Shift+S`)
  - 点击另存为
  - 验证能否选择新路径保存
  - 验证保存后路径是否更新

- [ ] **退出应用** (`Ctrl+Q` / `Cmd+Q`, macOS)
  - macOS：点击应用菜单中的退出
  - Windows/Linux：点击文件菜单中的退出
  - 验证应用是否正常退出

#### 编辑菜单
- [ ] **撤销** (`Ctrl+Z` / `Cmd+Z`)
  - 在 JSON 编辑器中输入内容
  - 点击撤销或使用快捷键
  - 验证是否回退到上一步

- [ ] **重做** (`Ctrl+Y` / `Cmd+Shift+Z`)
  - 撤销后点击重做
  - 验证是否恢复到撤销前

- [ ] **剪切** (`Ctrl+X` / `Cmd+X`)
  - 选中文本后点击剪切
  - 验证文本是否被剪切

- [ ] **复制** (`Ctrl+C` / `Cmd+C`)
  - 选中文本后点击复制
  - 验证文本是否被复制到剪贴板

- [ ] **粘贴** (`Ctrl+V` / `Cmd+V`)
  - 复制文本后点击粘贴
  - 验证文本是否正确粘贴

- [ ] **格式化** (`编辑` > `格式化`)
  - 在 JSON 编辑器中输入格式混乱的 JSON
  - 点击格式化菜单项
  - 验证 JSON 是否被正确格式化

#### 视图菜单
- [ ] **切换到表单模式**
  - 点击 `视图` > `表单模式`
  - 验证是否切换到表单视图

- [ ] **切换到 JSON 模式**
  - 点击 `视图` > `JSON 模式`
  - 验证是否切换到 JSON 编辑器

- [ ] **切换语言 - 中文**
  - 点击 `视图` > `语言` > `中文`
  - 验证：
    - 菜单文本是否变为中文
    - 界面文本是否变为中文
    - 错误消息是否变为中文

- [ ] **切换语言 - English**
  - 点击 `视图` > `语言` > `English`
  - 验证：
    - 菜单文本是否变为英文
    - 界面文本是否变为英文
    - 错误消息是否变为英文

#### 工具菜单
- [ ] **运行检查**
  - 点击 `工具` > `运行检查`
  - 验证是否显示运行检查结果
  - 验证错误消息是否为当前语言

- [ ] **运行验证**
  - 点击 `工具` > `运行验证`
  - 验证是否显示验证结果
  - 验证错误标签是否激活

- [ ] **向导**
  - 点击 `工具` > `向导`
  - 验证是否显示设置向导对话框

- [ ] **模板**
  - 点击 `工具` > `模板`
  - 验证是否显示模板库对话框

### 2. 快捷键测试

测试所有定义的快捷键是否正常工作：
- `Ctrl+O` / `Cmd+O` - 打开文件
- `Ctrl+S` / `Cmd+S` - 保存文件
- `Ctrl+Shift+S` / `Cmd+Shift+S` - 另存为
- `Ctrl+Z` / `Cmd+Z` - 撤销
- `Ctrl+Y` / `Cmd+Shift+Z` - 重做
- `Ctrl+X` / `Cmd+X` - 剪切
- `Ctrl+C` / `Cmd+C` - 复制
- `Ctrl+V` / `Cmd+V` - 粘贴
- `Ctrl+Q` / `Cmd+Q` - 退出（macOS）

### 3. 多语言测试

- [ ] 测试菜单在不同语言下的显示
- [ ] 测试语言切换时菜单文本是否实时更新
- [ ] 测试语言切换后功能是否正常

### 4. 跨平台测试

- [ ] **Windows**
  - 测试菜单栏显示位置（应在窗口顶部）
  - 测试快捷键（应使用 Ctrl）
  - 测试退出功能（应在文件菜单中）

- [ ] **macOS**
  - 测试应用菜单（应在菜单栏最左侧）
  - 测试快捷键（应使用 Cmd）
  - 测试退出功能（应在应用菜单中）

- [ ] **Linux**
  - 测试菜单栏显示
  - 测试快捷键（应使用 Ctrl）

## 🐛 已知问题和注意事项

1. **编译警告**：`menu_i18n.rs` 中有一些未使用的方法警告，这是正常的，因为这些方法在菜单构建时会被使用。

2. **语言切换**：菜单语言切换依赖于 `update_menu_locale` 命令，确保该命令正确调用。

3. **事件监听**：所有菜单事件都通过 `menu-event` 事件发送到前端，确保前端正确监听。

## 📝 测试记录

测试日期：_____________
测试人员：_____________
测试平台：_____________（Windows/macOS/Linux）

### 测试结果

| 功能 | 状态 | 备注 |
|------|------|------|
| 打开文件 | ☐ | |
| 保存文件 | ☐ | |
| 另存为 | ☐ | |
| 退出应用 | ☐ | |
| 撤销/重做 | ☐ | |
| 剪切/复制/粘贴 | ☐ | |
| 格式化 | ☐ | |
| 视图切换 | ☐ | |
| 语言切换 | ☐ | |
| 运行检查 | ☐ | |
| 运行验证 | ☐ | |
| 向导 | ☐ | |
| 模板 | ☐ | |

## 🔧 故障排查

如果菜单功能不工作，请检查：

1. **编译是否成功**
   ```bash
   cd src-tauri
   cargo check
   ```

2. **前端是否监听事件**
   - 打开浏览器开发者工具
   - 查看控制台是否有菜单事件日志
   - 检查是否有错误信息

3. **菜单是否正确初始化**
   - 检查 `src-tauri/src/lib.rs` 中的 `setup` 函数
   - 确认菜单构建函数被调用

4. **事件是否正确发送**
   - 检查 `on_menu_event` 处理器
   - 确认事件被发送到前端

## 📚 相关文档

- Tauri 2 菜单文档：https://tauri.app/api/menu/
- 项目状态：`PROJECT_STATUS.md`
- 菜单实现计划：`MENU_IMPLEMENTATION_PLAN.md`

