{
  "$schema": "https://raw.githubusercontent.com/SagerNet/sing-box/v1.12.12/docs/schema.json",
  "log": {
    "level": "info",
    "output": "stderr",
    "timestamp": true,
    "disabled": false
  },
  "dns": {
    "servers": [
      {
        "type": "local",
        "tag": "local",
        "detour": "direct"
      },
      {
        "type": "tls",
        "tag": "dns-tls",
        "server": "1.1.1.1",
        "server_port": 853,
        "tls": {
          "enabled": true,
          "server_name": "cloudflare-dns.com"
        }
      },
      {
        "type": "https",
        "tag": "dns-https",
        "server": "dns.google",
        "server_port": 443,
        "domain_resolver": "local",
        "path": "/dns-query",
        "tls": {
          "enabled": true,
          "server_name": "dns.google"
        }
      }
    ],
    "rules": [
      {
        "type": "default",
        "domain_suffix": [".local"],
        "server": "local"
      },
      {
        "type": "logical",
        "mode": "or",
        "rules": [
          {
            "type": "default",
            "domain_keyword": ["ads", "tracker"]
          },
          {
            "type": "default",
            "domain_suffix": [".ad", ".ads"]
          }
        ],
        "action": "reject"
      }
    ],
    "final": "dns-tls",
    "strategy": "prefer_ipv4"
  },
  "ntp": {
    "enabled": true,
    "server": "time.google.com",
    "server_port": 123,
    "interval": "1h",
    "write_to_system": false
  },
  "certificate": {
    "store": "system"
  },
  "endpoints": [
    {
      "type": "tailscale",
      "tag": "ts-endpoint",
      "state_directory": "./ts-state",
      "auth_key": "tskey-example",
      "hostname": "singbox-node"
    }
  ],
  "inbounds": [
    {
      "type": "socks",
      "tag": "socks-in",
      "listen": "127.0.0.1",
      "listen_port": 1080
    },
    {
      "type": "http",
      "tag": "http-in",
      "listen": "127.0.0.1",
      "listen_port": 7890
    }
  ],
  "outbounds": [
    {
      "type": "direct",
      "tag": "direct"
    },
    {
      "type": "shadowsocks",
      "tag": "proxy-out",
      "server": "example.com",
      "server_port": 8388,
      "method": "2022-blake3-aes-128-gcm",
      "password": "8JCsPssfgS8tiRwiMlhARg=="
    },
    {
      "type": "selector",
      "tag": "selector-out",
      "outbounds": ["proxy-out"],
      "default": "proxy-out"
    }
  ],
  "route": {
    "rules": [
      {
        "type": "default",
        "protocol": ["dns"],
        "action": "hijack-dns"
      },
      {
        "type": "default",
        "rule_set": ["ads"],
        "action": "reject"
      },
      {
        "type": "logical",
        "mode": "and",
        "rules": [
          {
            "type": "default",
            "rule_set": ["local-rules"]
          },
          {
            "type": "default",
            "network": ["tcp"]
          }
        ],
        "action": "route",
        "outbound": "direct"
      },
      {
        "type": "logical",
        "mode": "or",
        "rules": [
          {
            "type": "default",
            "domain_suffix": [".cn"]
          },
          {
            "type": "logical",
            "mode": "and",
            "rules": [
              {
                "type": "default",
                "network": ["tcp"]
              },
              {
                "type": "logical",
                "mode": "or",
                "rules": [
                  {
                    "type": "default",
                    "port": [80, 443]
                  },
                  {
                    "type": "default",
                    "domain_keyword": ["cdn"]
                  },
                  {
                    "type": "logical",
                    "mode": "and",
                    "rules": [
                      {
                        "type": "default",
                        "ip_cidr": ["10.0.0.0/8"]
                      },
                      {
                        "type": "default",
                        "protocol": ["http", "https"]
                      }
                    ]
                  }
                ],
                "invert": false
              }
            ],
            "invert": false
          }
        ],
        "action": "route",
        "outbound": "proxy-out"
      },
      {
        "type": "logical",
        "mode": "and",
        "rules": [
          {
            "type": "default",
            "rule_set": ["blocked"]
          },
          {
            "type": "logical",
            "mode": "or",
            "rules": [
              {
                "type": "default",
                "domain_keyword": ["ad", "track", "analytics"]
              },
              {
                "type": "default",
                "ip_cidr": ["192.168.0.0/16", "172.16.0.0/12"]
              },
              {
                "type": "logical",
                "mode": "and",
                "rules": [
                  {
                    "type": "default",
                    "process_name": ["chrome", "firefox"]
                  },
                  {
                    "type": "default",
                    "wifi_ssid": ["PublicWiFi"]
                  }
                ]
              }
            ]
          }
        ],
        "action": "reject",
        "reject_method": "default"
      },
      {
        "type": "default",
        "domain_suffix": [".com", ".org"],
        "action": "route",
        "outbound": "selector-out"
      }
    ],
    "rule_set": [
      {
        "type": "remote",
        "tag": "ads",
        "url": "https://example.com/rules/ads.json",
        "format": "source",
        "download_detour": "direct",
        "update_interval": "1d"
      },
      {
        "type": "remote",
        "tag": "blocked",
        "url": "https://example.com/rules/blocked.json",
        "format": "source"
      },
      {
        "type": "local",
        "tag": "local-rules",
        "path": "./rules.json",
        "format": "source"
      },
      {
        "type": "inline",
        "tag": "inline-rules",
        "rules": [
          {
            "type": "default",
            "domain_suffix": ["test.local"]
          },
          {
            "type": "logical",
            "mode": "or",
            "rules": [
              {
                "type": "default",
                "domain": ["internal.company.com"]
              },
              {
                "type": "default",
                "ip_cidr": ["10.0.0.0/24"]
              }
            ]
          }
        ]
      }
    ],
    "final": "selector-out",
    "find_process": true,
    "auto_detect_interface": true,
    "override_android_vpn": false,
    "default_mark": 0,
    "default_domain_resolver": {
      "server": "local"
    },
    "default_network_strategy": "default",
    "default_network_type": "wifi",
    "default_fallback_network_type": "cellular",
    "default_fallback_delay": "500ms"
  },
  "services": [
    {
      "type": "derp",
      "tag": "derp-svc",
      "listen": "0.0.0.0",
      "listen_port": 33445,
      "config_path": "./derp.yaml",
      "tls": {
        "certificate_path": "./cert.pem",
        "key_path": "./key.pem",
        "enabled": true,
        "server_name": "example.com"
      }
    }
  ],
  "experimental": {
    "clash_api": {
      "external_controller": "127.0.0.1:9090",
      "secret": "secret_key_here"
    }
  }
}